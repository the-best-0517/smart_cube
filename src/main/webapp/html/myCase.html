<!doctype html>
<html>
<head>
    <meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />

    <title>智立方</title>
    <link rel="stylesheet" type="text/css" href="../css/common.css"/>
    <link rel="stylesheet" type="text/css" href="../css/main.css"/>
    <style>
    	.seeCase-myCase{
    		    width: auto;
    			height: auto;
    			border: 1px solid #000;
    			line-height: 50px;
    	}
    	.list-group-item{
    		border-bottom: 1px solid #000;
    	}
    	.panel-heading{
    	    border-bottom: 1px solid #000;
    	}
    	/* .box-wrap {    	    
            text-align: center;
            background-color: #f9f9f9;
            overflow: hidden; 
            border: 0px solid #fff;
         } */
       .seeCase-myCase {
            border: 0px solid #000;
        }
       .box {
            text-align: center;
            width: 20%;
            height:4px;
            padding-bottom: 26%;
            margin-left: 33px;
            border-radius: 2%;
            float: left;
            background-color: #f9f9f9;
            border: 1px solid #000;
         }
       .result-list a {
            margin-right: 15px;
            float: right;
          }
       #popupcontent{ 
            position: absolute; 
            visibility: hidden; 
            overflow: hidden; 
            border:1px solid #232221; 
            background-color:#eff3f3; 
            padding:5px; 
            margin-left: 278px;
      } 
      .check{
            width: 20px;
            height: 20px;
            float: left;
            margin-top: -28px;
            margin-left: 204px
      }
    </style>
</head>
<body>
<div class="topbar-wrap white">
    <div class="topbar-inner clearfix">
        <div class="topbar-logo-wrap clearfix">
            <h1 class="topbar-logo none"><a href="index.html" class="navbar-brand">后台管理</a></h1>
            <ul class="navbar-list clearfix">
                <li><a class="on" href="index.html">智立方</a></li>   
                <li><a class="on" href="../index.html">首页</a></li>    
            </ul>
        </div>
        <div class="top-info-wrap">
            <ul class="top-info-list clearfix">                
               <li><a href="login.html">退出</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="container clearfix">
    <div class="sidebar-wrap">
        <div class="sidebar-title">
            <h1>菜单</h1>
        </div>
        <div class="sidebar-content">
            <ul class="sidebar-list">
                <li>
                    <a href="#"><i class="icon-font">&#xe003;</i>常用操作</a>
                <ul class="sub-menu">
                        <li><a href="billRecord.html"><i class="icon-font">&#xe008;</i>吃药记录</a></li>
                        <li><a href="billNews.html"><i class="icon-font">&#xe005;</i>药品论坛</a></li>
                        <li><a href="myCase.html"><i class="icon-font">&#xe006;</i>我的病历</a></li>
                   <!-- <li><a href="design.html"><i class="icon-font">&#xe012;</i>评论管理</a></li>-->
                        <li><a href="telemanagement.html"><i class="icon-font">&#xe052;</i>远程知晓</a></li>
                        <!--<li><a href="design.html"><i class="icon-font">&#xe033;</i>广告管理</a></li>-->
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="icon-font">&#xe018;</i>系统管理</a>
                    <ul class="sub-menu">
                    	<li><a href="power.html"><i class="icon-font">&#xe012;</i>权限管理</a></li>
                    	<li><a href="timedTask.html"><i class="icon-font">&#xe004;</i>定时留言</a></li>
                        <li><a href="system.html"><i class="icon-font">&#xe017;</i>系统设置</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <!--/sidebar-->
    <div class="main-wrap" id="mainWrap">

        <div class="crumb-wrap">
            <div class="crumb-list"><i class="icon-font"></i><a href="index.html">首页</a><span class="crumb-step">&gt;</span><span class="crumb-name">我的病例</span></div>
        </div>
        <div class="result-title">
             <div class="result-list" onclick="deleteBox();">
                 <a><i class="icon-font"></i>删除</a>
            </div>
   <!--          <div class="result-list" onclick="showPopup(600,500,-1);">
                 <a><i class="icon-font"></i>新增病历</a>
            </div>  -->           
        </div>
        <div class="seeCase-myCase" id="addBox" >
        	<!-- <div class="box-wrap"> -->
	        <div class="box" id="box0" onclick="showPopup(600,500,0);">	           
	           <ul class="panel-heading">病例标题</ul>
	           <ul class="list-group">
		           <li class="list-group-item">2018-08-08</li>
		           <li class="list-group-item">病情描述</li>
		           <li class="list-group-item">所吃药品</li>
		           <li class="list-group-item">等</li>
		           <li class="list-group-item">等</li>
	           </ul>
	           <div><input class="check" id="check0" type="checkbox" style="display:none"/></div>
	        </div>
        </div>
    </div>
    <!--/main-->
    <div id="popupcontent">
        <div style="margin-top:30px">
           <a style="padding-left:20px;padding-right:20px;">病例标题</a>
           <input type="text" name="title" id="title" style="background:#fff;border:1px solid #eae8e8;width:78%;"/>
        </div>
        <div style="margin-top:30px">
           <a style="padding-left:49px;padding-right:20px;">时间</a>
           <input type="datetime" name="time" id="time" style="background:#fff;border:1px solid #eae8e8;width:78%;"/>
        </div>
        <div style="margin-top:30px">
           <div><a style="padding-left:20px;padding-right:20px;">病情描述</a></div>
           <textarea rows="3" name="describe" id="describe" cols="78" style="width:78%;margin-left: 101px;margin-top: -20px;"></textarea>
        </div>
<!--         <div style="margin-top:30px">
           <div><a style="padding-left:20px;padding-right:20px;">所吃药品</a></div>
           <textarea rows="3" name="pill" id="pill" cols="20" style="width: 28%;height: 65px;margin-left: 101px;margin-top: -20px;"></textarea>
        </div> -->
        <div style="margin-top:30px">
           <a style="padding-left:49px;padding-right:20px;">图片</a>
           <div id="addPicture">
             <input type="image" name="picture" id="picture" style="background:#fff;border:1px solid #eae8e8;width:18%;" src="images/logo.png"/>
           </div>
                 <div style="margin-top: 80px;margin-left: 388px;">
           <!--  <input type="button" name="save" id="save" value="确定" onclick="createBox();" style="width: 70px;height: 31px;margin-right: 42px;"/>
 -->            <input type="button" name="cancle" id="cancle" value="取消" onclick="hidePopup();" style="width: 70px;height:  31px;"/>
        <div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript" src="../js/jquery-2.1.0.js" ></script>
<script>
var baseText = null; 
var index = 1;
var flags = new Array();

function addPicture(data){
	var img ='  <input type="image" name="picture" id="picture" style="background:#fff;border:1px solid #eae8e8;width:18%;" src="[imgPath]"/>';
	for(var i=0;i<data.length;i++){
	   var i = img.replace("[imgPath]","http://120.79.10.49:8080/smart_cube/"+data[i].imgPath);
	   $('#addPicture').append(i);
	}
} 
/**
 * 新增/编辑功能
 */
function showPopup(w,h,s,caseId){
	$('#addPicture').empty();
	var url = "../case/showCaseImg.do";
	$.post(url,{caseId:caseId},function(res){
		if(res.state==1){
			 addPicture(res.data);
		}
	});
	
   var boxName = '#box'+s+' ul';
   var boxInput = '#box'+s+' div input';
   if($(boxInput).is(':checked')){
	   flags[s] = true;
	    return;
   }
   if(flags[s]){
	   flags[s]=false;
	   return;
   }
   var popUp = document.getElementById("popupcontent"); 
   popUp.style.top = "150px"; 
   popUp.style.left = "150px"; 
   popUp.style.width = w + "px"; 
   popUp.style.height = h + "px"; 
   popUp.style.visibility = "visible"; 

   var main = document.getElementById("mainWrap"); 
   main.style.opacity="0.3";
   var title="";
   var time="";
   var describe="";
   var pill="";
   var picture="";
   var arr = new Array();
   if(s!=-1){
	   
	  for(var i =0 ;i<2;i++){
		 title = $(boxName).eq(0).html();
		 if(i==1){
			 for(var j =0 ;j<$(boxName).eq(1).find("li").length;j++){
				 arr[j]=$(boxName).eq(1).find("li").eq(j).html();
			 }
		 }
	   }
	 	time = arr[0];
	 	describe = arr[1];
	 	pill = arr[2];
	 	$("#title").val(title);
	 	$("#time").val(time);
	 	$("#describe").val(describe);
	 	$("#pill").val(pill);
	 	//后台编辑功能
     }else{
	    $("#title").val("");
	    $("#time").val("");
	    $("#describe").val("");
	    $("#pill").val("");
     }
 

} 

function hidePopup(){ 
var popUp = document.getElementById("popupcontent"); 
popUp.style.visibility = "hidden"; 
var main = document.getElementById("mainWrap"); 
main.style.opacity="1";
} 

function createBox(){
	var title="";
	var time="";
	var describe="";
	var pill="";
    var picture="";
    title = $("#title").val();
    time =  $("#time").val();
    describe =  $("#describe").val();
    pill = $("#pill").val();
    
    var content = '<div class="box" id="box'+index+'" onclick="showPopup(600,500,'+index+');">'
                 +'<ul class="panel-heading">'+title+'</ul>'
                 +'<ul class="list-group">'
                 +'  <li class="list-group-item">'+time+'</li>'
                 +'  <li class="list-group-item">'+describe+'</li>'
                 +'  <li class="list-group-item">'+pill+'</li>'
                 +'  <li class="list-group-item">等</li>'
                 +'  <li class="list-group-item">等</li>'
                 +'</ul>'
                 +'<div><input class="check" id="check'+index+'" type="checkbox" style="display:none"/></div>'
                 +'</div>';
    $('#addBox').append(content);
    index++;
    //添加保存功能
    hidePopup();
}

var flag = 0;

function deleteBox(){
	var ids = new Array();
	$("input[type = checkbox]").each(function(){
		var name = $(this).attr("id");
		if(document.getElementById(name).checked){
			ids.push(name);
        }
		
	});
	var idstr=ids.join(',');
	if(idstr==""){
		if(flag%2==0){
			$("input[type = checkbox]").each(function(){
			    $(this).show();
			});
		    flag++;
		}else if(flag%2==1){
			$("input[type = checkbox]").each(function(){
				var name = $(this).attr("id");
				if(document.getElementById(name).checked){
					 $(this).show();
				}else{
					 $(this).hide();
				}		   
			});
		    flag++;
		}
	}else{
		var a = confirm("确定删除此病历?");
		if(a){
			for(var i=0;i<ids.length;i++){
				var ps = "#"+ids[i];
				//模拟删除
				$(ps).parent().parent().remove();
			}
		}	
	}	
	
}
$(function(){
	showAllCase();
});
/**
 * 展示所有case
 */
 function showAllCase(){
  	var url = "../case/showAllCase.do";
  	$.get(url,function(res){
  		if(res.state==1){
  			addCase(res.data);
  		}
  	});
}
function addCase(data){
	var div='  <div class="box" id="box0" >	   '        
	    + '   <ul class="panel-heading" id="[caseId]" onclick="showPopup(600,500,0,this.id);">[title]</ul>'
	    +  '  <ul class="list-group">'
		+ '         <li class="list-group-item">[time]</li>'
		+  '         <li class="list-group-item">[describe]</li>'
/* 		+  '         <li class="list-group-item"[pill]</li>'
		+  '         <li class="list-group-item">等</li>'
		+  '         <li class="list-group-item">等</li>' */
	    +   '  </ul>'
	    +  '   <div><input class="check" id="check0" type="checkbox" style="display:none"/></div>'
	  	+  ' </div>';
	$("#addBox").empty();
	for(var i=0;i<data.length;i++){
		var d = div.replace("[title]",data[i].caseHospital)
				   .replace("[caseId]",data[i].caseId)
				   .replace("[describe]",data[i].caseDesc)
				   .replace("[time]",new Date(data[i].caseTime).toLocaleString());
		$("#addBox").append(d);	
	}
}
</script>
</html>